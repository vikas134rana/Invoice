<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<title>Asset - InvoicePrinting</title>

<div th:replace="header :: headerHead"></div>

<style>
/* Remove the navbar's default margin-bottom and rounded borders */
.navbar {
	margin-bottom: 0;
	border-radius: 0;
}

#container {
	margin: 10px;
}

.form-section-label {
	font-weight: bold;
}

.form-section {
	margin-top: 10px;
}

#searchForm {
	margin: 10px;
}

#searchForm td {
	padding: 5px;
}

#searchForm label {
	margin-left: 20px;
}

.required:after {
	content: " *";
	color: red;
}

#invoicePrintingSearchDiv {
	margin: auto;
	margin-top: 30px;
	padding: 10px;
	width: 60%;
	border: 1px solid black;
	border-radius: 5px;
}
</style>

<script>
	$(document).ready(function() {
		var date_input = $('input[name="startDate_search"], input[name="endDate_search"]');
		var container = $('.bootstrap-iso form').length > 0 ? $('.bootstrap-iso form').parent() : "body";
		var options = {
			format : 'yyyy/mm/dd',
			container : container,
			todayHighlight : true,
			autoclose : true,
		};
		date_input.datepicker(options);
		date_input.val(formatCurrentDate());
	});

	function formatCurrentDate() {
		var d = new Date(), month = '' + (d.getMonth() + 1), day = '' + d.getDate(), year = d.getFullYear();

		if (month.length < 2)
			month = '0' + month;
		if (day.length < 2)
			day = '0' + day;

		return [ year, month, day ].join('/');
	}
</script>

<script th:inline="javascript">

    var flag = [[${modify}]]; //Your Thymleaf variable
    window.onload = function() {   
    	if(!flag)
            return; // Exit if the variable is false
        $('#modifyModal').modal('show');
    };
</script>

</head>

<body>

	<div th:replace="header::pageHeader"></div>

	<!-- Invoice successfully modified msg -->
	<div th:if="${invoiceModifySuccessMsg != null}" th:text="${invoiceModifySuccessMsg}" class="alert alert-success"></div>

	<div id="invoicePrintingSearchDiv">

		<form action="/invoicePrintingSearch">

			<table id="searchForm">
				<tr>
					<td><label>Invoice Number</label></td>
					<td><input type="text" name="invoiceNumber_search" /></td>

					<td><label>Seller</label></td>
					<td><input type="text" name="sellerId_search" /></td>

					<td><label>Buyer</label></td>
					<td><input type="text" name="buyerId_search" /></td>

				</tr>

				<tr>
					<td><label>Invoice Type</label></td>
					<td><select name="invoiceType_search">
							<option value="0">Select Invoice Type</option>
							<option value="1">Asset Transfer</option>
							<option value="2">Other</option>
							<option value="3">Cross</option>
							<option value="4">Export</option>
							<option value="5">Inward Delivery Challan</option>
							<option value="6">Inward Delivery Challan</option>
					</select></td>

					<td><label class="required">Start Date </label></td>
					<td><input type="text" name="startDate_search" placeholder="MM/DD/YYYY" required /></td>

					<td><label class="required">End Date</label></td>
					<td><input type="text" name="endDate_search" placeholder="MM/DD/YYYY" required /></td>


					<td align="right"><input width="80px" type="submit" value="Search" class="btn btn-dark"></td>
				</tr>

			</table>

		</form>

	</div>

	<div id="container">

		<table class="table table-striped table-bordered" id="itemtable">
			<thead class="thead-dark">
				<tr>
					<th>Sr No.</th>
					<th>Invoice Number</th>
					<th>Type</th>
					<th>Status</th>
					<th>Date</th>
					<th>Seller</th>
					<th>Buyer</th>
					<th>Total Amount</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="invoice: ${invoices}">
					<td th:text="${invoiceStat.index+1}"></td>
					<td th:text="${invoice.invoiceNumber}"></td>
					<td th:text="${invoice.typeValue}"></td>
					<td th:text="${invoice.statusCode}"></td>
					<td th:text="${invoice.creationDate}"></td>
					<td th:text="${invoice.seller.address.name}"></td>
					<td th:text="${invoice.buyer.address.name}"></td>
					<td th:text="${invoice.totalPrice}"></td>
					<td>
						<button type="button" th:onclick="'window.location.href=\'/modifyInvoiceForm?id=' + ${invoice.id} + '\''" class="btn btn-outline-dark">
							<span class="fa fa-edit"></span> Modify
						</button>
						<button type="button" th:onclick="'window.location.href=\'/invoiceDownload?id=' + ${invoice.id} + '\''" class="btn btn-outline-dark">
							<span class="fa fa-download"></span> Download
						</button>
						<button type="button" th:onclick="'window.location.href=\'/invoiceCancel?id=' + ${invoice.id} + '\''" class="btn btn-outline-dark">
							<span class="fa fa-times-circle"></span> Cancel
						</button>
					</td>
				</tr>
			</tbody>
		</table>

	</div>

	<!-- Modify Invoice -->
	<div th:if="${invoiceToModify!=null}" class="modal fade" tabindex="-1" id="modifyModal" role="dialog">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" th:text="${'Modify Invoice '+ invoiceToModify.invoiceNumber}"></h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<form action="/asset/modifyInvoice">
					<div class="modal-body">
						<p></p>
						<table>
							<tr>
								<td><label>Invoice Number</label></td>
								<td><input type="text" name="param1" th:value="${invoiceToModify.invoiceNumber}">
								<input type="hidden" name="id" th:value="${invoiceToModify.id}"></td>
							</tr>
							<tr>
								<td><label>Status</label></td>
								<td><input type="text" name="param2" th:value="${invoiceToModify.statusCode}"></td>
							</tr>
						</table>

					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-secondary" data-dismiss="modal" value="Close" /> <input type="submit" class="btn btn-primary" value="Save" />
					</div>
				</form>
			</div>
		</div>
	</div>


</body>
</html>
